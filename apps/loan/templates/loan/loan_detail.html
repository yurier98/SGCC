{% extends 'includes/list.html' %}
{% load groups_tags %}
{% load static %}
{% load widget_tweaks %}

{% block stylesheets %}

    <link rel="stylesheet" href="{% static 'lib/bootstrap-daterangepicker-3.1/css/daterangepicker.css' %}"/>
    <link href="{% static 'lib/jquery-ui-1.12.1/jquery-ui.min.css' %}" rel="stylesheet"/>
    <link href="{% static 'lib/select2-4.0.13/css/select2.min.css' %}" rel="stylesheet"/>
    <link href="{% static 'lib/select2-4.0.13/css/select2-bootstrap4.min.css' %}" rel="stylesheet"/>
    <link href="{% static 'lib/tempusdominus-bootstrap-4.5.37.0/css/tempusdominus-bootstrap.css' %}" rel="stylesheet"/>
    <link href="{% static 'lib/bootstrap-touchspin-4.2.5/css/jquery.bootstrap-touchspin.css' %}" rel="stylesheet"/>

{% endblock %}

{% block javascript %}
    <script src="{% static 'lib/bootstrap-daterangepicker-3.1/js/spanish.js' %}"></script>
    <script src="{% static 'lib/bootstrap-daterangepicker-3.1/js/daterangepicker.js' %}"></script>
    <script src="{% static 'lib/jquery-ui-1.12.1/jquery-ui.min.js' %}"></script>
    <script src="{% static 'lib/select2-4.0.13/js/select2.min.js' %}"></script>
    <script src="{% static 'lib/select2-4.0.13/js/i18n/es.js' %}"></script>
    <script src="{% static 'lib/moment-2.25.3/moment-with-locales.js' %}"></script>
    <script src="{% static 'lib/tempusdominus-bootstrap-4.5.37.0/js/tempusdominus-bootstrap.js' %}"></script>
    <script src="{% static 'lib/bootstrap-touchspin-4.2.5/js/jquery.bootstrap-touchspin.js' %}"></script>
    <script src="{% static 'order/js/details.js' %}"></script>
    <script>
        order.details.products = {{ products|safe }};
    </script>
{% endblock %}

{% block content %}
    <div class="app-wrapper">
        <div class="app-content pt-3 p-md-3 p-lg-4">
            <div class="container-xl">
                <div class="row g-3 mb-4 align-items-center justify-content-between">
                    <div class="col-auto">
                        <h1 class="app-page-title mb-0">{{ entity }}</h1>
                        {% include "includes/_breadcrumbs.html" %}
                    </div>
                    <div class="col-auto">
                        <div class="page-utilities">
                            <div class="row g-2 justify-content-start justify-content-md-end align-items-center">
                                <div class="col-auto ">
                                    {% block content_list_before %}{% endblock %}
                                </div><!--//col-->
                            </div><!--//row-->
                        </div><!--//table-utilities-->
                    </div><!--//col-auto-->
                </div>

                <form id="frmOrder" class="app-card-settings " method="post" data-url="{{ list_url }}">
                    <div class=" settings-form row g-3 mb-5  align-items-start">
                        <div class="app-card-header p-3 border-bottom-0">
                            <h4 class="app-card-title">{{ title }}</h4>
                            <hr>
                        </div>
                        <div class="app-card-body px-4 w-100">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-lg-8">
                                        <div class="app-card app-card-orders-table shadow-sm mb-5  align-items-start">
                                            <div class="app-card-header p-2 border-bottom-0">
                                                <h3 class="app-card-title">
                                                    <div class="app-icon-holder"><i class="fas fa-boxes"></i></div>
                                                    Artículos encargados
                                                </h3>
                                                <hr>
                                            </div>
                                            <div class="app-card-body">
                                                <div class="table-responsive p-2">
                                                    <table class="table app-table-hover mb-0 text-left "
                                                           id="tblProducts">
                                                        <thead>
                                                        <tr>
                                                            <th class="cell">Imagen</th>
                                                            <th class="cell">Producto</th>
                                                            <th class="cell">Categoría</th>
                                                            <th class="cell">Cantidad disponible</th>
                                                            <th class="cell">Cantidad deseada</th>
                                                            <th class="cell">Estado</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div><!--//app-card-->
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="app-card shadow-sm mb-5 align-items-start">
                                            <div class="app-card-header p-3 border-bottom-0">
                                                <div class="row align-items-center gx-3">
                                                    <div class="col-auto">
                                                        <div class="app-icon-holder">
                                                            <svg width="1em" height="1em" viewBox="0 0 16 16"
                                                                 class="bi bi-person" fill="currentColor"
                                                                 xmlns="http://www.w3.org/2000/svg">
                                                                <path fill-rule="evenodd"
                                                                      d="M10 5a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm6 5c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"></path>
                                                            </svg>
                                                        </div><!--//icon-holder-->

                                                    </div><!--//col-->
                                                    <div class="col-auto">
                                                        <h4 class="app-card-title"> Datos del usuario</h4>
                                                    </div><!--//col-->
                                                </div><!--//row-->
                                                <hr>
                                            </div>
                                            <div class="app-card-body px-4 w-100">

                                                <div class="item border-bottom py-3">
                                                    <div class="row justify-content-between align-items-center">
                                                        <div class="col-auto">
                                                            <div class="item-label"><strong>Nombre</strong>
                                                            </div>
                                                            <div class="item-data"> {{ object.user.get_full_name }}</div>
                                                        </div><!--//col-->

                                                    </div><!--//row-->
                                                </div><!--//item-->
                                                <div class="item border-bottom py-3">
                                                    <div class="row justify-content-between align-items-center">
                                                        <div class="col-auto">
                                                            <div class="item-label"><strong>Área</strong>
                                                            </div>
                                                            <div class="item-data"> {{ object.user.area }}
                                                            </div>
                                                        </div><!--//col-->

                                                    </div><!--//row-->
                                                </div><!--//item-->
                                                <div class="item border-bottom py-3">
                                                    <div class="row justify-content-between align-items-center">
                                                        <div class="col-auto">
                                                            <div class="item-label"><strong>Solapin</strong></div>
                                                            <div class="item-data"> {{ object.user.solapin }}</div>
                                                        </div><!--//col-->

                                                    </div><!--//row-->
                                                </div><!--//item-->
                                                <div class="item border-bottom py-3">
                                                    <div class="row justify-content-between align-items-center">
                                                        <div class="col-auto">
                                                            <div class="item-label"><strong>Teléfono</strong></div>
                                                            <div class="item-data"> {{ object.user.phone }}</div>
                                                        </div><!--//col-->
                                                    </div><!--//row-->
                                                </div><!--//item-->
                                                <div class="item py-3">
                                                    <div class="row justify-content-between align-items-center">
                                                        <div class="col-auto">
                                                            <div class="item-label"><strong>Dirección de correo
                                                                electrónico</strong></div>
                                                            <div class="item-data">
                                                                {{ object.user.email }}
                                                            </div>
                                                        </div><!--//col-->
                                                    </div><!--//row-->
                                                </div><!--//item-->
                                            </div>
                                        </div>
                                        <div class="app-card shadow-sm mb-5 align-items-start">
                                            <div class="app-card-header p-2 border-bottom-0">
                                                <h3 class="app-card-title">

                                                    <div class="app-icon-holder">
                                                        <i class="bi bi-cart2 fa-2x"
                                                           style="line-height: 0;"></i>
                                                    </div>
                                                    Detalles del pedido
                                                </h3>
                                                <hr>
                                            </div>
                                            <div class="app-card-body px-4 w-100">
                                                <div class="item border-bottom py-3">
                                                    <div class="row justify-content-between align-items-center">
                                                        <div class="col-auto">
                                                            <div class="item-label"><strong>Rango de fecha </strong>
                                                            </div>
                                                            <div class="item-data"> {{ object.start_date |date:"D d M Y" }}
                                                                - {{ object.end_date |date:"D d M Y" }}</div>
                                                        </div><!--//col-->

                                                    </div><!--//row-->
                                                </div><!--//item-->
                                                <div class="item border-bottom py-3">
                                                    <div class="row justify-content-between align-items-center">
                                                        <div class="col-auto">
                                                            <div class="item-label"><strong>Fecha de creado</strong>
                                                            </div>
                                                            <div class="item-data"> {{ object.created |date:"D d M Y" }}
                                                            </div>
                                                        </div><!--//col-->

                                                    </div><!--//row-->
                                                </div><!--//item-->
                                                <div class="item border-bottom py-3">
                                                    <div class="row justify-content-between align-items-center">
                                                        <div class="col-auto">
                                                            <div class="item-label"><strong>Manifestación</strong></div>
                                                            <div class="item-data"> {{ object.manifestation }}</div>
                                                        </div><!--//col-->

                                                    </div><!--//row-->
                                                </div><!--//item-->
                                                <div class="item border-bottom py-3">
                                                    <div class="row justify-content-between align-items-center">
                                                        <div class="col-auto">
                                                            <div class="item-label"><strong>Descripción</strong></div>
                                                            <div class="item-data">{{ object.description }}</div>
                                                        </div><!--//col-->
                                                    </div><!--//row-->
                                                </div><!--//item-->
                                                <div class="item py-3">
                                                    <div class="row justify-content-between align-items-center">
                                                        <div class="col-auto">
                                                            <div class="item-label"><strong>Estado</strong></div>
                                                            <div class="item-data">
                                                                {% if object.state == 'Pendiente' %}
                                                                    <span class="badge bg-warning"> Pendiente </span>
                                                                {% elif object.state == 'Aprobado' %}
                                                                    <span class="badge bg-success"> Aprobado </span>
                                                                {% else %}
                                                                    <span class="badge bg-danger"> No Aprobado </span>
                                                                {% endif %}
                                                            </div>
                                                        </div><!--//col-->
                                                        <div class="col text-end">

                                                            {% if request.user|has_group:"Técnico" %}
                                                                {% if object.state == 'Pendiente' %}
                                                                    <div class="btn-group">
                                                                        <button type="button"
                                                                                class="btn-sm app-btn-secondary dropdown-toggle"
                                                                                data-bs-toggle="dropdown"
                                                                                aria-expanded="false">
                                                                            Cambiar
                                                                        </button>
                                                                        <ul class="dropdown-menu" style="">
                                                                            <li><a class="dropdown-item"
                                                                                   href="{% url 'order_approve' object.pk %}">
                                                                                <i class="bi bi-file-earmark-check"
                                                                                   style="color: #15a362;"></i>
                                                                                {#                  <i class="fas fa-check-square"></i>#}
                                                                                Aprobar</a></li>
                                                                            <li><a class="dropdown-item"
                                                                                   href="{% url 'order_deny' object.pk %}">
                                                                                <i class="bi bi-file-earmark-x"
                                                                                   style="color: #fb866a;"></i>
                                                                                Denegar</a></li>
                                                                        </ul>
                                                                    </div>
                                                                {% endif %}
                                                            {% endif %}
                                                        </div><!--//col-->
                                                    </div><!--//row-->
                                                </div><!--//item-->
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="app-card-footer p-4 mt-auto">
                            <hr>
                            <div class="mt-3 row justify-content-between">
                                <div class="col-auto">

                                </div>
                                <div class="col-auto">
                                    <button type="submit" class="btn app-btn-primary btn-flat">
                                        <i class="fas fa-save"></i> Guardar registro
                                    </button>
                                    <a href="{{ list_url }}" class="btn app-btn-secondary btn-flat">
                                        <i class="fas fa-times"></i> Cancelar
                                    </a>
                                </div>
                            </div>

                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block modal %}
    <div class="modal fade" id="myModalSearchProducts" tabindex="-1" role="dialog"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document" data-bs-backdrop="false">
            <div class=" modal-content app-card app-card-orders-table">

                <div class="modal-header app-card-header  p-2 border-bottom-0">
                    <h3 class="modal-title app-card-title justify-content-between align-items-center">
                        <div class="app-icon-holder">
                            <i class="bi bi-search fa-2x" style="line-height: 0;"></i>
                        </div>
                        Búsqueda de Productos
                    </h3>
                    <hr>
                </div>

                <div class="modal-body app-card-body app-card-orders-table p-3 mt-auto">
                    <table class="table app-table-hover mb-0 text-left " id="tblSearchProducts">
                        <thead>
                        <tr>
                            <th class="cell">Producto</th>
                            <th class="cell">Imagen</th>
                            <th class="cell">Cantidad disponible</th>
                            <th class="cell">Categoría</th>
                            <th class="cell">Opciones</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
